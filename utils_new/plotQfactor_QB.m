% Author:        Quentin Brissaud.
% Mail:          TODO.
% Description:   TODO.
% Last modified: See file metadata.
% Usage:         N/A.
% Notes:         N/A.    

clear all

% tau_epsilon(1,:) = [4.262332253966861E-002 1.851561240017022E-003];
% tau_sigma(1,:)   = [3.876976972195918E-002 1.669539210862250E-003];
% tau_epsilon(2,:) = [4.260395276908462E-002 1.856317437490798E-003];
% tau_sigma(2,:)   = [3.833318400245433E-002 1.652248125544272E-003];

%% Carcione
%   tau_epsilon(1,:) = [2.777320375916291d-002 3.187084050385516d-003 3.683612420748419d-004];
%   tau_sigma(1,:) = [2.730926321834314d-002 3.145516983560762d-003 3.620115821834951d-004];
%% SPECFEM
%  tau_epsilon(1,:) = [3.3490038309560245E-002   3.3205062588009785E-003   3.3551297958320871E-004];
%  tau_sigma(1,:) = [3.1830988618379068E-002   3.1830988618379067E-003   3.1830988618379065E-004];
  
% tau_epsilon(1,:) = [ 0.0325305d0 0.0032530d0 ];
% tau_sigma(1,:)   = [ 0.0311465d0 0.0031146d0 ];
% tau_epsilon(2,:) = [ 0.0332577d0 0.0033257d0 ];
% tau_sigma(2,:)   = [ 0.0304655d0 0.0030465d0 ];

% tau_epsilon(1,:) = [ 4.6476875357377961E-002   2.0335832691717954E-003];
% tau_sigma(1,:)   = [ 3.8769769721959099E-002   1.6695392108622528E-003];
% tau_epsilon(2,:) = [ 4.6874721535758702E-002   2.0603867494416398E-003];
% tau_sigma(2,:)   = [ 3.8333184002496135E-002   1.6522481255475596E-003];

% tau_epsilon(1,:) = [  0.17725537627672650        3.4833560493244708E-002   1.0237679297424787E-002   3.0651696886944526E-003   7.5459919548867853E-004];
% tau_sigma(1,:)   = [ 0.13367539543027052        2.9124611199363264E-002   8.5823094231770244E-003   2.5335157195151741E-003   5.4051987488499533E-004];
% tau_epsilon(2,:) = [ 0.18156880701146530        3.5432683576702928E-002   1.0417236569858469E-002   3.1263506630997881E-003   7.8156930071421283E-004];
% tau_sigma(2,:)   = [ 0.13308844353639387        2.9029245975774359E-002   8.5534447912655395E-003   2.5253187741990065E-003   5.3806638052894193E-004];

% tau_epsilon(1,:) = [0.25807791902293820 5.4894396041040315E-002 1.6170701364632733E-002 4.7738909076965085E-003 1.0445323614216280E-003];
% tau_sigma(1,:)   = [0.24917288473167501 5.3800637489755353E-002 1.5862813443282636E-002 4.6780620809510898E-003 1.0077273395349541E-003];
% tau_epsilon(2,:) = [0.32683936445099093 6.3781350136288523E-002 1.8751521703846908E-002 5.6275346547857048E-003 1.4068330423488852E-003];
% tau_sigma(2,:) = [0.23957053663125735 5.2254579640177698E-002 1.5396590440188901E-002 4.5456490660782823E-003 9.6852316330235427E-004];

% tau_epsilon(1,:) = [0.28897309300316870        5.8709029277262084E-002   1.7254012642232374E-002  5.1246328409675027E-003   1.1891394190244734E-003];
% tau_sigma(1,:)   = [0.24484125310777013        5.3109104117542771E-002   1.5654068800789778E-002  4.6187502867743859E-003   9.9019364192466739E-004];
% tau_epsilon(2,:) = [0.32683936445099093        6.3781350136288523E-002   1.8751521703846908E-002  5.6275346547857048E-003   1.4068330423488852E-003];
% tau_sigma(2,:) = [0.23957053663125735        5.2254579640177698E-002   1.5396590440188901E-002  4.5456490660782823E-003   9.6852316330235427E-004];

% tau_epsilon(1,:) = [0.30167683998378081       6.0360555450003510E-002  1.7734672629431056E-002  5.2838382446413409E-003,   1.2568633585686383E-003];
%  tau_sigma(1,:) = [0.24305711437355090       5.2821497630325655E-002   1.5567313426235796E-002  4.5940421741842621E-003  9.8289635193069122E-004];
%  tau_epsilon(2,:) = [0.32683936445099093        6.3781350136288523E-002   1.8751521703846908E-002  5.6275346547857048E-003   1.4068330423488852E-003];
%  tau_sigma(2,:) = [0.23957053663125735        5.2254579640177698E-002   1.5396590440188901E-002 4.5456490660782823E-003  9.6852316330235427E-004];
 
%    tau_epsilon(1,:) = [0.32683936445099093 6.3781350136288523E-002 1.8751521703846908E-002 ...
%         5.6275346547857048E-003 1.4068330423488852E-003 ];
%    tau_sigma(1,:) = [4.1741359937728149 19.137078642406994 64.949444741333977 ...
%         219.99058560469584 1032.4998284917831 ];
%   tau_sigma(1,:) = 1./tau_sigma(1,:);
%   tau_epsilon(2,:) = [0.32683936445099093 6.3781350136288523E-002 1.8751521703846908E-002 ...
%         5.6275346547857048E-003 1.4068330423488852E-003];
%   tau_sigma(2,:) = [4.1741359937728149 19.137078642406994 64.949444741333977 ...
%         219.99058560469584 1032.4998284917831 ];
%   tau_sigma(2,:) = 1./tau_sigma(2,:);
  
% % % %   tau_epsilon(2,:) = [0.32683936445099093 6.3781350136288523E-002 1.8751521703846908E-002 ... 
% % % %         5.6275346547857048E-003 1.4068330423488852E-003];
% % % %   tau_sigma(2,:) = [4.1741359937728149 19.137078642406994 64.949444741333977 ...
% % % %         219.99058560469584 1032.4998284917831 ];
% % % %   tau_sigma(2,:) = 1./tau_sigma(2,:);
% % % %   
% % % %   tau_epsilon(1,:) =   [0.28129690885543823        5.7734750211238861E-002   1.6973519697785378E-002   5.0325277261435986E-003   1.1505676666274667E-003];
% % % %  tau_sigma(1,:) =  [ 0.24591287970542908        5.3281020373106003E-002   1.5705768018960953E-002   4.6332636848092079E-003   9.9448743276298046E-004];
 
 %% Leo seismic
  tau_epsilon(1,:) =  [ 0.25313396195527554       1.09163768103025405E-002];
 tau_sigma(1,:) =   [0.22962286350984851       9.85685340323495633E-003];
 tau_epsilon(2,:) =  [ 0.26508359588818803       1.16512236085833335E-002];
 tau_sigma(2,:) =  [ 0.21678194278647300       9.34322053214898390E-003];
 
%% Qkappa = 400
%   tau_epsilon(1,:) =   [1.7949194887017783       0.27174800876540578        5.1326939959507115E-002   9.7146213712757095E-003   1.5074988451520186E-003];
%  tau_sigma(1,:) =  [ 1.7271502402376160       0.26457067614238072        4.9986164475716209E-002   9.4557226726012210E-003   1.4491861820140116E-003];
 
 
%  tau_epsilon(1,:) = [0.28129691825915842        5.7734751049464170E-002   1.6973520534336692E-002 ...
%      5.0325276799552668E-003   1.1505676288768804E-003];
%  tau_sigma(1,:) = [0.24591287983624682        5.3281018769616009E-002   1.5705767634218777E-002 ...
%     4.6332637077137317E-003   9.9448748454030941E-004];
  
  
%   
%   tau_epsilon(1,:) =   [0.27615585393317488        5.7092018752260207E-002 ...
%  1.6790359478735969E-002   4.9730764395180928E-003   1.1258628892499322E-003];
%   tau_sigma(1,:) =   [0.24662607469436260        5.3395251076202459E-002 ...
%   1.5740665457535233E-002   4.6433427356312946E-003   9.9746568092092154E-004];
%   tau_epsilon(2,:) =   [0.28897309300316870        5.8709029277262084E-002 ...
%  1.7254012642232374E-002   5.1246328409675027E-003,   1.1891394190244734E-003];
%   tau_sigma(2,:) =   [0.24484125310777013        5.3109104117542771E-002 ...
%    1.5654068800789778E-002   4.6187502867743859E-003   9.9019364192466739E-004];

 
%  tau_epsilon(1,:) = [0.32683935761451721        6.3781350851058960E-002   1.8751522526144981E-002   5.6275348179042339E-003   1.4068330638110638E-003];
%  tau_sigma(1,:) =   [0.23957054316997528        5.2254579961299896E-002   1.5396590344607830E-002   4.5456490479409695E-003   9.6852314891293645E-004];
 
%  tau_epsilon(1,:) = tau_epsilon(2,:);
% tau_sigma(1,:)   = tau_sigma(2,:);
 
% tau_epsilon(1,:) = [    0.25417519566050434        5.4431545961366457E-002   1.6042036239361377E-002   4.7330604388495252E-003   1.0281428354371187E-003];
% tau_sigma(1,:)   = [0.24971783344747633        5.3886321089554635E-002   1.5888841763628928E-002   4.6854725706283783E-003   1.0099196252875023E-003];
% tau_epsilon(2,:) = [ 0.32683936445099093        6.3781350136288523E-002   1.8751521703846908E-002   5.6275346547857048E-003   1.4068330423488852E-003];
% tau_sigma(2,:)   = [ 0.23957053663125735        5.2254579640177698E-002   1.5396590440188901E-002   4.5456490660782823E-003   9.6852316330235427E-004];

% tau_epsilon(1,:) =   [0.26585449219526525,        5.5829983369082632E-002   1.6432933245772188E-002 ...
%           4.8573988499202927E-003   1.0783440914539318E-003];
%  tau_sigma(1,:) =   [0.24808351784604002,        5.3629316427852874E-002   1.5811110007943146E-002 ...
%           4.6631051267298478E-003   1.0032848822882584E-003];
%  tau_epsilon(2,:) =   [0.28129691825915842        5.7734751049464170E-002   1.6973520534336692E-002 ...
%     5.0325276799552668E-003   1.1505676288768804E-003];
%  tau_sigma(2,:) =   [0.24591287983624682        5.3281018769616009E-002   1.5705767634218777E-002 ...
%     4.6332637077137317E-003   9.9448748454030941E-004];

% tau_epsilon(2,:) =    [3.6333390308238500       0.68884975816685035       0.20376323794128304     ...
%          6.2874895238903772E-002   1.9548893674250289E-002   6.0184750551988964E-003,   1.6061749544148682E-003];
%  tau_sigma(2,:) =   [2.4068653955834178       0.52686340987670266       0.15657434590381653    ...
%           4.7997581048739010E-002   1.4783033933844831E-002   4.4418619683092020E-003   9.5576752383246194E-004];

% %% Sediments
% tau_epsilon(1,:) = [0.32683936445099093 6.3781350136288523E-002 1.8751521703846908E-002 5.6275346547857048E-003 1.4068330423488852E-003 ];
% tau_sigma(1,:) = [ 4.1741359937728149 19.137078642406994 64.949444741333977 219.99058560469584 1032.4998284917831 ];
% tau_sigma(1,:) = 1./tau_sigma;
% tau_epsilon(1,:) = tau_epsilon(2,:);
% tau_sigma(1,:)   = tau_sigma(2,:);

%% Frequency
f = 0:0.01:200;
omega = 2*pi*f;


%% Complex modulus
L = length(tau_epsilon);

M1C = 0%1. - L;
M2C = 0%1. - L;

%% Initialization
rho = 1500;
vp = 2000;
vs = 2206.;
M1 = rho*(2*vp^2-2*(2-1)*vs^2);
M2 = 2*rho*vs^2;

f0_attenuation = 0.;

factor_M1 = 0.
factor_M2 = 0.
factor_M1_2 = 1.
factor_M2_2 = 1.

for k=1:L

M1C = M1C + (1+ i*omega*tau_epsilon(1,k))./(1 + i*omega*tau_sigma(1,k));
M2C = M2C + (1+ i*omega*tau_epsilon(2,k))./(1 + i*omega*tau_sigma(2,k));

factor_M1 = factor_M1 + (tau_epsilon(1,k))./(tau_sigma(1,k));
factor_M2 = factor_M2 + (tau_epsilon(2,k))./(tau_sigma(2,k));

factor_M1_2_temp = ((tau_epsilon(1,k))./(tau_sigma(1,k)) -1);
factor_M2_2_temp = ((tau_epsilon(2,k))./(tau_sigma(2,k)) -1);

factor_M1_2 = factor_M1_2 + factor_M1_2_temp/(1. + 1./(2 * pi * f0_attenuation * tau_sigma(1,k))^2)/L;
factor_M2_2 = factor_M2_2 + factor_M2_2_temp/(1. + 1./(2 * pi * f0_attenuation * (tau_sigma(2,k)))^2)/L;

end

%% SPECFEM
factor_M2_2_save = factor_M2_2;
factor_M1_2 = (1+(1/L)*(-L+factor_M1))/factor_M1_2;
factor_M2_2 = (1+(1/L)*(-L+factor_M2))/factor_M2_2;

%% Carcione
factor_M1 = (1+(1/L)*(-L+factor_M1));
factor_M2 = (1+(1/L)*(-L+factor_M2));

M1C = (1 + (1/L)*(M1C-L))*M1;
M2C = (1 + (1/L)*(M2C-L))*M2;

%% P and S wave velocities
Vp = sqrt((M1C+M2C)/(2*rho));
Vs = sqrt((M2C)/(2*rho));

Vp = 3297.849;
Vs = 2222.536;
Qp = (1-(Vs./Vp).^2).*(1./40) + ((Vs./Vp).^2)*(1/20);
Qp = 1/Qp;

%% Quality factors
Q1 = real(M1C+M2C)./imag(M1C+M2C);
Q2 = real(M2C)./imag(M2C);

%% Display
figure; hold on
% semilogx(f, sqrt(real(Vp).^2 + imag(Vp).^2))
% semilogx(f, sqrt(real(Vs).^2 + imag(Vs).^2))
% legend('P-wave velocity','S-wave velocity')
loglog(f, 1./Q1)
loglog(f, 1./Q2)
legend('P-wave quality','S-wave quality')
axis([0 100 -inf inf])